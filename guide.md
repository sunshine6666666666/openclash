# TR3000 OpenClash AI 接续手册（实战抽象版）

> 本文件给 AI 使用，不是给终端用户的完整教程。  
> 作用：上下文压缩后，AI 能沿正确路径继续，不重复踩坑。

## 1. 项目目标（能力导向）

用户真正目标不是“某插件名”，而是：
- 机场订阅可快速替换
- 节点可切换（最好自动优选）
- 国内直连、境外代理
- 日常维护成本低（新手可持续操作）

结论：当“稳定性”和“花哨功能”冲突时，优先稳定。

## 2. 当前有效终态（最新）

已达成：
- 固件已在 `ImmortalWrt 24.10.4`（`cudy_tr3000-256mb-v1`）
- `opkg update` 可用，签名校验通过
- `luci-app-openclash` 已安装，Meta 内核可运行
- 订阅已导入，运行状态为 `Meta 运行中`
- 基础分流验证通过（国内站正常，GitHub/YouTube 可达）

未完成（收口项）：
- 部署拓扑固定（长期常驻方案）
- 安全加固收尾（账号/无线隐私项复核）
- 备份与“机场跑路应急切换”模板化

## 3. 决策顺序（会话内必须遵守）

1. **先确认当前节点，再给下一步**
   - 当前在哪个页面、看到什么状态、是否已生效。
2. **一次只做一个动作**
   - 新手模式：一条命令或一个点击，不并行推进。
3. **先验证，再进入下一步**
   - 每步都要拿到输出或截图证据。
4. **路径变化先解释理由**
   - 例如从“华为子母路由接入”切回“直连先完成配置”，先讲为什么再执行。

## 4. 版本与兼容性思维框架

每次新会话先过 4 层检查：

1. **设备层**
   - 设备 ID 是否仍为 `cudy,tr3000-256mb-v1`。
2. **系统层**
   - 系统/内核是否仍是 24.10.4 / 6.6.110 这条对齐链。
3. **仓库层**
   - `opkg update` 是否成功，签名是否通过。
4. **运行层**
   - OpenClash 是否 `Meta 运行中`、配置文件是否加载。

只要其中任一层不通过，先修该层，不跨层推进。

## 5. 错误案例黑名单（明确禁止）

### 5.1 禁止：镜像不匹配时强刷

- 典型报错：`Image check failed` / `not supported by this device`
- 错误思路：同型号文件名相似就强制升级
- 正确做法：严格按 `256mb-v1` 元数据匹配

### 5.2 禁止：内核不对齐时硬装代理栈

- 典型报错：`kmod-*` 依赖冲突
- 错误思路：包列表里看得到就持续尝试安装
- 正确做法：先升级到内核与仓库一致的固件基线

### 5.3 禁止：网络/时间未通过就排查插件

- 典型报错：`Operation not permitted`、`certificate is not yet valid`
- 错误思路：先怀疑 OpenClash 或镜像源
- 正确做法：先测连通性，再校时，再 `opkg update`

### 5.4 禁止：把“页面已切节点”误判为“未保存”

- 典型现象：用户担心面板点击无持久化
- 正确判断：看代理组显示的当前节点是否变化，再刷新确认

## 6. 当前推荐拓扑（按用户偏好）

用户偏好是“慢一点也行，但换订阅要快，且不中断沟通”。  
当前推荐：
- Cudy 常驻中间层（上游接家庭 Wi-Fi/子母路由，下游给终端）
- 重点做“主备订阅切换”，不折腾复杂网络改造

说明：双无线中继会损失性能，但换订阅/换节点更符合用户真实诉求。

## 7. 接续执行模板（下一会话直接用）

1. 先确认 OpenClash 首页仍为 `Meta 运行中`
2. 复核四项关键开关：
   - 运行模式：`Fake-IP`
   - 代理模式：`规则`
   - DNS 代理：`启用`
   - 域名嗅探：`启用`
3. 完成“主备订阅”新增与切换演练
4. 导出 OpenClash 备份到本地
5. 交付用户一句话应急口令（机场失效时如何 1 分钟恢复）

## 8. AI 输出风格约束

- 用中文、短句、一步一步。
- 不灌输大段概念，优先可操作步骤。
- 用户未要求时，不展开多方案分支。
- 每一步结尾都要告诉用户“完成后回什么信息”。
